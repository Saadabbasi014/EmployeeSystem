@model EmployeeSystem.Models.AddEmployeeViewModel

@{
}
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous" />
<head>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
</head>
<style>
    .form-container {
        width: 500px;
        margin: 20px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        position: relative;
    }

    .timer {
        position: absolute;
        top: 10px;
        right: 10px;
    }

    /* Ensure forms are displayed in rows */
    .form-row {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
    }

    /* Red highlight for timer in last 10 seconds */
    .red-highlight {
        color: red;
    }
</style>
<h1>Add Employee</h1>
@*  <form method="post" action="Add" class="mt-5">
    <div class="mb-3">
        <label for="" class="form-label">Department</label>
        <input type="text" class="form-control" asp-for="Department">
    </div>
    <div class="mb-3">
        <label for="" class="form-label">Date Of Birth</label>
        <input type="date" class="form-control" asp-for="DOB">
    </div>
    <div class="mb-3">
        <label for="" class="form-label">Employee Color</label>
        <input type="text" class="form-control" asp-for="EmployeeColor">
    </div>
    <div class="mb-3">
        <label for="" class="form-label">Employee Name</label>
        <input type="text" class="form-control" asp-for="EmployeeName">
    </div>
    <div class="mb-3">
        <label for="" class="form-label">Form Number</label>
        <input type="number" class="form-control" asp-for="FormNumber">
    </div>
    <div class="mb-3">
        <label for="" class="form-label">Salary</label>
        <input type="number" class="form-control" asp-for="Salary">
    </div>
    <button type="submit" class="btn btn-primary">Submit</button>
</form>  *@

  <div class="custom-box mx-auto mt-3">
      <div class="container form-1">
        <form id="myForm">
          <div class="row">
            <div class="col-6 mb-3">
              <label for="employeeCount" class="form-label"
                >Enter a number (1-10):</label
              >
              <input
                type="number"
                class="form-control"
                id="employeeCount"
                name="employeeCount"
                min="1"
                max="10"
                required
              />
            </div>

            <div class="col-6 mb-3">
              <label for="colorSelect" class="form-label"
                >Select a color:</label
              >
              <select
                class="form-control"
                id="colorSelect"
                name="colorSelect"
                required
              >
                <option value="red" style="background-color: red; color: white">
                  Red
                </option>
                <option value="green" style="background-color: green">
                  Green
                </option>
                <option
                  value="blue"
                  style="background-color: blue; color: white"
                >
                  Blue
                </option>
                <option value="orange" style="background-color: orange">
                  Orange
                </option>
                <option
                  value="brown"
                  style="background-color: brown; color: white"
                >
                  Brown
                </option>
                <option
                  value="purple"
                  style="background-color: purple; color: white"
                >
                  Purple
                </option>
              </select>
            </div>
          </div>

          <button
            type="button"
            class="btn btn-primary"
            style="margin-top: 100px; margin-left: 180px"
            onclick="generateForms()"
          >
            Submit
          </button>
        </form>
      </div>
    </div>
<div id="formsContainer" class="d-flex"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-o3oZ3xok7D5t1eElH6fbIJSx8rjfl3fkxcjN5xgA5v3oBd6PLRDv1sAiSDElXIz3"
        crossorigin="anonymous"></script>

    <script src="~/js-models/add-emplopee/Index.js"></script>

<!-- Include jQuery library -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<!-- Include jQuery library -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
@section Scripts{
    <script src="//cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.4/jquery.validate.min.js" integrity="sha512-FOhq9HThdn7ltbK8abmGn60A/EMtEzIzv1rvuh+DqzJtSGq8BRdEN0U+j0iKEIffiw/yEtVuladk6rsG4X6Uqg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
}
<script src='http://domain.com/script.js' type='text/javascript'></script>
<script src='http://domain.com/script2.js' type='text/javascript'></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" integrity="sha512-vKMx8UnXk60zUwyUnUPM3HbQo8QfmNx7+ltw8Pm5zLusl1XIfwcxo8DbWCqMGKaWeNxWA8yrx5v3SaVpMvR3CA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js" integrity="sha512-VEd+nq25CkR676O+pLBnDW09R7VQX9Mdiij052gVCp5yVH3jGtH70Ho/UUv4mJDsEdTvqRCFZg0NKGiojGnUCw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script>
    jQuery(document).ready(function ($) {
        console.log("hello")
    });
    function generateForms() {
        var employeeCount = $("#employeeCount").val();
        var colorSelect = $("#colorSelect").val();

        if (employeeCount < 1 || employeeCount > 10) {
            alert("Please enter a number between 1 and 10.");
            return;
        }

        $("#formsContainer").empty();

        var rows = Math.ceil(employeeCount / 6); 

        for (var i = 1; i <= rows; i++) {
            var formRow = $("<div>").addClass("form-row");

            for (var j = 1; j <= 3; j++) {
                var formNumber = (i - 1) * 3 + j;

                if (formNumber <= employeeCount) {
                    var formContainer = $("<div>").addClass("form-container").attr("id", "form-" + formNumber);

                    var timer = $("<div>").addClass("timer");
                    var secondsRemaining = formNumber * 120; 
                    updateTimer(timer, secondsRemaining);
                    formContainer.append(timer);

                    var form = $("<form>").html(`
        <div class="form-group">
            <label for="employeeName${formNumber}">Name:</label>
            <input type="text" class="form-control" id="employeeName${formNumber}" name="employeeName" placeholder="Employee${formNumber}" required>
        </div>

        <div class="form-group">
            <label for="dob${formNumber}">Date of Birth:</label>
            <input type="date" class="form-control" id="dob${formNumber}" name="dob" required>
        </div>

        <div class="form-group">
            <label for="salary${formNumber}">Salary:</label>
                <input type="text" class="form-control" id="salary${formNumber}" name="salary" placeholder="50000" required>
        </div>

        <div class="form-group">
            <label for="department${formNumber}">Department:</label>
            <select class="form-control" id="department${formNumber}" name="department" required>
                <option value="Web">Web</option>
                <option value="Desktop">Desktop</option>
                <option value="QA">QA</option>
                <option value="Management">Management</option>
                <option value="HR">HR</option>
            </select>
        </div>

        <button type="button" class="btn btn-primary submit-btn">Submit</button>
    `);

                    formContainer.append(form);

                    formRow.append(formContainer);

                    startTimer(timer, secondsRemaining);
                }
            }

            $("#formsContainer").append(formRow);
        }

        $(".submit-btn").on("click", function () {
            var formNumber = $(this).closest(".form-container").attr("id").split("-")[1];
            submitForm(formNumber);
        });
    }

    function startTimer(timerElement, secondsRemaining) {
        var intervalId = setInterval(function () {
            secondsRemaining--;
            updateTimer(timerElement, secondsRemaining);

            if (secondsRemaining <= 0) {
                clearInterval(intervalId);
                disableSubmitButton(timerElement);
            } else if (secondsRemaining <= 10) {
                timerElement.addClass("red-highlight"); 
            }
        }, 1000);
    }

    function updateTimer(timerElement, secondsRemaining) {
        var minutes = Math.floor(secondsRemaining / 60);
        var seconds = secondsRemaining % 60;
        timerElement.text("Timer: " + minutes + "m " + seconds + "s");
    }

    function disableSubmitButton(timerElement) {
        var formContainer = timerElement.parent();
        var submitButton = formContainer.find("button");
        submitButton.prop("disabled", true);
    }

    function submitForm(formNumber) {
        var formContainer = $("#form-" + formNumber);
        var submitButton = formContainer.find("button");
        submitButton.prop("disabled", true);

        var employeeName = formContainer.find("[name='employeeName']").val();
        var dob = formContainer.find("[name='dob']").val();
        var salary = formContainer.find("[name='salary']").val();
        var department = formContainer.find("[name='department']").val();
        var colorSelect = $("#colorSelect").val();

        var formData = {
            EmployeeName: employeeName,
            EmployeeColor: colorSelect,
            DOB: dob,
            Department: department,
            FormNumber: formNumber,
            Salary: salary,
          
        };
        console.log("formData", formData);

        $.ajax({
            url: '/Employee/AddData',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function (response) {
                const { status, message } = response;
                if (status) {
                    toastr.success(message);
                } else {
                    toastr.error(message, 'Error');
                    submitButton.prop("disabled", false);
                }

            },
            error: function (xhr, status, error) {
                toastr.error('Technical error occured', 'Error');
                submitButton.prop("disabled", false);
            }
        });
    }

</script> 

